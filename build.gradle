import org.apache.tools.ant.filters.ReplaceTokens

plugins {
    id "com.github.johnrengelman.shadow" version "5.2.0"
    id "java"
    id 'io.github.slimjar' version '1.2.1'
}

// naming
version = '2.2.2-SNAPSHOT'
group = 'dev.spaceseries'
def packageGroup = group + '.spacechat'

repositories {
    mavenCentral()
    jcenter()

    maven { url 'https://repo.yakovliam.com/releases/' }
    maven { url 'https://oss.sonatype.org/content/groups/public/' }
    maven { url 'https://repo.codemc.org/repository/maven-public/' }
    maven { url 'https://hub.spigotmc.org/nexus/content/repositories/snapshots/' }
    maven { url 'https://oss.sonatype.org/content/repositories/releases/' }
    maven { url 'https://oss.sonatype.org/content/repositories/central/' }
    maven { url 'https://repo.extendedclip.com/content/repositories/placeholderapi/' }
}

dependencies {
    // https://mvnrepository.com/artifact/org.jetbrains/annotations
    compileOnly group: 'org.jetbrains', name: 'annotations', version: '16.0.1'

    // spigot
    compileOnly 'org.spigotmc:spigot-api:1.17-R0.1-SNAPSHOT'

    // space api
    slim 'dev.spaceseries:spaceapi:1.0.12'

    // placeholderAPI
    compileOnly 'me.clip:placeholderapi:2.10.9'

    // bstats
    implementation "org.bstats:bstats-bukkit:2.2.1"

    // caffeine
    slim 'com.github.ben-manes.caffeine:caffeine:2.9.2'

    // mysql
    // https://mvnrepository.com/artifact/mysql/mysql-connector-java
    slim group: 'mysql', name: 'mysql-connector-java', version: '8.0.25'

    // adventure
    slim "net.kyori:adventure-api:4.8.1"
    slim "net.kyori:adventure-platform-bukkit:4.0.0-SNAPSHOT"
    slim "net.kyori:adventure-text-minimessage:4.1.0-SNAPSHOT"
}

artifacts {
    archives shadowJar
}

jar {
    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

shadowJar {
    archiveName("SpaceChat-${project.version}.jar")
}

slimJar {
    relocate 'org.bstats', "${packageGroup}.lib.bstats"
    relocate 'dev.spaceseries.spaceapi', "${packageGroup}.lib.spaceapi"
    relocate 'net.kyori', "${packageGroup}.lib.kyori"
    relocate 'com.github.benmanes.caffeine', "${packageGroup}.lib.caffeine"
}

processResources {
    filter ReplaceTokens, tokens: [version: project.version]
}